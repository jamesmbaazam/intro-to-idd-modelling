---
title: "Introduction to Infectious Disease Modelling"
author: "James Mba Azam, PhD"
execute:
  echo: true
# format: clean-revealjs
format:
  revealjs: 
    theme: solarized
    slide-number: true
    scrollable: true
    chalkboard: true
revealjs-plugins:
  - revealjs-text-resizer
bibliography: references.bib
link-citations: true
engine: knitr
---

# An overview of infectious diseases

## What are infectious diseasess

::: columns
::: {.column width="50%"}
![Generic definition of a disease (source: Merriam Webster)](images/disease_definition.png){.lightbox}
:::

::: {.column width="50%"}
Depending on what we care about, we can classify diseases according to:

-   Cause (e.g., infectious, non-infectious)
-   Duration (e.g., acute, chronic)
-   Mode of transmission (direct or indirect)
-   Impact on the host (e.g., fatal, non-fatal)
:::
:::

---

- Note that these classifications are not mutually exclusive. Hence, a disease can be classified under more than one category at a time.

## How are infectious diseases controlled?

-   In general, infectious disease control aims to reduce disease transmission.
-   The type of control used depends on the disease and its characteristics.
-   Broadly, there are two main types of control measures:
    -   Pharmaceutical interventions (PIs)
    -   Non-pharmaceutical interventions (NPIs)

------------------------------------------------------------------------

### Pharmaceutical interventions (PIs)

-   Pharmaceutical Interventions are medical interventions that target the pathogen or the host.

-   Examples:

    -   Vaccines,
    -   Antiviral drugs, and
    -   Antibiotics.

------------------------------------------------------------------------

### Vaccination

-   Most effective way to prevent infectious diseases.
-   Activates the host's immune system to produce antibodies against the pathogen.
-   Generally applied prophylactically to susceptible individuals (before infection); this reduces the risk of infection and disease.
-   Challenges:
    -   Take time to develop for new pathogens
    -   Never 100% effective and limited duration of protection
    -   Adverse side effects
    -   Some individuals cannot be vaccinated or refuce vaccination
    -   Some pathogens mutate rapidly (e.g., influenza virus)

------------------------------------------------------------------------

### Non-pharmaceutical interventions (NPIs)

-   Non-pharmaceutical interventions are measures that do not involve medical interventions.

-   Examples:

    -   Quarantine,
    -   Physical/social distancing, and
    -   Mask-wearing.

------------------------------------------------------------------------

### Quarantine

-   *Isolation of individuals who may have been exposed to a contagious disease*.
-   Advantage is that it's simple and its effectiveness does not depend on the disease.
-   Disadvantages include:
    -   Infringement on individual rights
    -   Can be difficult to enforce
    -   Can be costly
    -   Can lead to social stigma

[What type of intervention is contact tracing?]{style="color:red;"}

------------------------------------------------------------------------

### Contact tracing

-   Contact tracing is not necessarily an NPI but is often used to identify likely infected individuals.
-   It involves identifying, assessing, and managing people who have been exposed to a contagious disease to prevent further transmission.
-   It is a critical component of infectious disease surveillance and is often used in combination with other control measures.

------------------------------------------------------------------------

::: {.callout-caution collapse="true" icon=false}
# Question

- How do we quantify the impact of a control measure?
:::

# Infectious disease models

## What are infectious disease models?

-   [*Models*]{style="color:red;"} generally refer to conceptual representations of an object or system.
-   [*Mathematical models*]{style="color:red;"} use mathematics to represent the description of the system.
-   [*Infectious disease models*]{style="color:red;"} use mathematics/statistics to represent dynamics/spread of infectious diseases.

------------------------------------------------------------------------

-   Mathematical models can be used to link the biological process of disease transmission and the emergent dynamics of infection at the population level.
-   Models require making some assumptions and abstractions.
-   By definition, "all models are wrong, but some are useful" [@Box1979].
    -   Good enough models are those that capture the essential features of the system being studied.
-   "Wrong" here means that models are simplifications of reality and do not capture all the complexities of the system being studied. It does not mean that models are useless.

------------------------------------------------------------------------

\<Insert example of some models and their assumptions and what makes them "wrong"\>

------------------------------------------------------------------------

## (Conflicting) Factors that influence model formulation/choice

-   Accuracy: how well does the model to reproduce observed data and predict future outcomes?
-   Transparency: is it easy to understand and interpret the model and its outputs? (This is affected by the model's complexity)
-   Flexibility: the ability of the model to be adapted to different scenarios.

## What are models used for?

-   Generally, models can be used to predict and understand/explain the dynamics of infectious diseases.

[How are these two uses impacted by accuracy, transparency, and flexibility?]{style="color:red;"}

------------------------------------------------------------------------

### Modelling to predict the future course

::: columns
::: {.column width="40%"}
-   Must be [accurate]{style="color:red;"} else they will provide an incorrect outlook of the future.
-   Example of the [prediction of Ebola deaths](https://apnews.com/domestic-news-domestic-news-fbb4fc8921d54201a1c5ca91e5b601f5) during the outbreak in West Africa in 2014/2015.
-   "But the estimate proved to be off. Way, way off. Like, 65 times worse than what ended up happening."
:::

::: {.column width="60%"}
![Controversy over estimates of Ebola deaths](images/wrong_ebola_deaths_estimate.png){.lightbox}
:::
:::

------------------------------------------------------------------------

\< Insert examples of models that have made accurate predictions of the future course of an outbreak \>

------------------------------------------------------------------------

### Modelling to understand or explain

-   Models can be used to understand how a disease spreads and how its spread can be controlled.
-   The insights gained from models can be used to:
    -   inform public health policy and interventions.
    -   design interventions to control the spread of the disease, for example, randomised controlled trials.
    -   collect new data.
    -   build predictive models.

------------------------------------------------------------------------

\< Insert examples of models that explain the spread and dynamics of infectious diseases \>

\< Insert examples of models that evaluate the impact of interventions and determine the next course of action \>

------------------------------------------------------------------------

## Limitations of infectious disease models

-   Host behaviour is often difficult to predict.
-   The pathogen often has unknown characteristics or known characteristics that are difficult to model.
-   Data is often not available or is of poor quality.

------------------------------------------------------------------------

-   Models:
    -   Simplifications of reality and do not capture all the complexities of the system being studied.
    -   Only as good as the data used to parameterize them.
    -   Can be sensitive to the assumptions made during their formulation.
    -   Can be computationally expensive and require a lot of data to run.
    -   Can be difficult to interpret and communicate to non-experts.

## What skills are needed to build and use infectious disease models?

-   Mathematical and statistical skills:
    -   Differential equations.
    -   Probability and statistics.
    -   Stochastic processes.
    -   Numerical analysis
    -   Time series analyses
    -   Survival analysis

---

-   Programming skills:
    -   Proficiency in at least one programming language (e.g., R, Python, Julia, C++).
    -   Experience with version control (e.g., Git).
    -   Experience with data manipulation and visualization.

---

-   Domain knowledge in infectious diseases:
    -   Immunology.
    -   Epidemiology.
    -   Virology.
    -   Genomics
    
---

-   Other subject areas:

  - Communication skills:
    -   Ability to communicate complex ideas to non-experts.
    -   Ability to write clear and concise reports.
    -   Ability to present results to a diverse audience.
  -   Public health.
  -   Health economics.
  - Policy analysis.

# Introduction to compartmental models

## What are compartmental models?

-   Compartmental models divide populations into compartments (or groups) based on individual's infection status [@Blackwood2018a].
-   Individuals move between compartments based on defined transition quantities.
-   Any particular individual can only be in one compartment at a time.

------------------------------------------------------------------------

::: columns
::: {.column width="40%"}
-   They divide the population into compartments based on the [disease status]{style="color:red;"} of individuals.
-   The most common compartments are:
    -   Susceptible (S) - hosts are not infected but can be infected
    -   Infected (I) - hosts are infected (and can infect others)
    -   Removed (R) - hosts are no longer infected and cannot be re-infected
-   In compartmental models, individuals move between compartments based on defined transition quantities.
:::

::: {.column width="60%"}
![Infection timeline illustrating how a pathogen in a host interacts with the host's immune system (source: Modelling Infectious Diseases of Humans and Animals)](images/infection_timeline.png){.lightbox}
:::
:::

------------------------------------------------------------------------

-   Other compartments can be added to the model to account for important events or processes (e.g., exposed, recovered, vaccinated, etc.)

-   It is, however, important to keep the model simple, less computationally intensive, and interpretable.

# Some simple compartmental models

-   We are going to consider infections that either confer immunity after recovery or not.
-   The simplest compartmental models for capturing this are the SIS and SIR models.

## The Susceptible-Infected-Recovered model (SIR)

- SIR models are used to model diseases that confer immunity after recovery.

- The SIR model groups individuals into three _disease states_:
  - Susceptible (S): individuals who are not infected and can be infected.
  - Infected (I): individuals who are infected and can infect others.
  - Removed (R): individuals who have recovered from the infection and are immune.
 
- This framework was popularised by Kermack and McKendrick in 1927 [@kermack1927contribution]
  - A must-read paper for anyone interested in infectious disease modelling.

---

![Diagram of an SIR/SIRS model](images/sir_sirs_model.png){.lightbox}

## Model equations

- The SIR model is described by the following set of differential equations:

\begin{aligned}
\frac{dS}{dt} & = \color{orange}{-\beta \frac{S I}{N}} \\
\frac{dI}{dt} & = \color{orange}{\beta \frac{S I}{N}} - \color{cornflowerblue}{\gamma I} \\
\frac{dR}{dt} & = \color{cornflowerblue}{\gamma I}
\end{aligned}

---

With initial conditions $S(0) > 0$, $I(0) > 0$, and $R(0) = 0$.

where:

- $N$ is the total population size.
- $\beta$ is the transmission rate.
- $\gamma$ is the recovery rate.

---

## Solving the SIR model

- Compartmental models cannot be solved analytically.

- Other methods are used to understand the dynamics of the model:
  - Numerical simulations.
  - Qualitative analysis of the equations; threshold phenomena.

---

### Numerical simulations

- Numerical simulations can be performed with any programming language.

- This course focuses on R:
  - In R, we can use the `deSolve` package to solve the differential equations.
  - You are welcome to try it in other languages (Tip: Julia is really fast for complex models).

---

### Threshold phenomena

- We can also study the conditions under which an epidemic will grow or die out using the model equations.

- Two key threshold phenomena are often studied:
  - The basic reproduction number ($R_0$).
  - The herd immunity threshold.

---

- The [basic reproduction number ($R_0$)]{style="color:blue"}: the average number of secondary infections caused by a single infected individual in a [_completely susceptible_]{style="color:tomato;"} population.


- The [herd immunity threshold]{style="color:blue"}: the proportion of the population that needs to be immune (by vaccination or natural infection) to prevent the epidemic from growing. This is often calculated as [$1 - \dfrac{1}{R_0}$]{style="color:red"}

::: {.callout-caution collapse="true" icon=false}
# Question

- How would you interpret the herd immunity required for a disease with $R_0 = 2$?

:::


## Numerical simulations in R

- To solve the model in R, we will always need to define at least three things:
  - The model equations.
  - The parameter values.
  - The initial conditions.

- We will need the `deSolve` package to solve the model.

---

- Let's start by defining the model equations.

```{r sir-model}
# Define the SIR model
sir_model <- function(t, state, parameters) {
  with(as.list(c(state, parameters)), {
    dS <- -beta * S * I
    dI <- beta * S * I - gamma * I
    dR <- gamma * I
    return(list(c(dS, dI, dR)))
  })
}
```

---

Next, we will define the parameter values and initial conditions.

```{r parameter-values}
# define parameters we know
N  <- 1  
R0 <- 10
infectious_period <- 7

# Remember gamma <- 1/ infectious_period as discussed earlier
gamma <- 1/infectious_period 

# We will use R0 = beta N / gamma  instead because it is easier to interpret.
# beta is not directly interpretable.

params <- c(beta = R0 * gamma / N, gamma = gamma)

# Initial conditions for S, I, R
# Why is S = N - 1?
inits <- c(S = N - 0.001, I = 0.000001, R = 0)

# Time steps to return results
dt <- 1:70
```

---

Finally, we will solve the model using the `ode` function from the `deSolve` package.

```{r solve-sir-model}
#| cache: true
# Solve the model
results <- deSolve::ode(
  y = inits,
  times = dt,
  func = sir_model,
  parms = params
)

# Make it a data.frame
results <- as.data.frame(results)
```

---

Now, let's plot the results.

```{r plot-sir}
#| echo: true
#| output-location: slide
#| cache: true
# Load the necessary libraries
library(dplyr)
library(tidyr)
library(ggplot2)
# Create data for ggplot2 by reshaping
results_long <- results |> 
  pivot_longer(cols = c(2:4), names_to = "compartment", values_to = "value")
  
plot <- ggplot(data = results_long,
  aes(x = time, y = value, color = compartment)
  ) +
geom_line(linewidth = 1) +
labs(
  title = "SIR model",
  x = "Time",
  y = "Number of individuals"
) 
print(plot)
```

---

## Model assumptions

- There are no inflows or outflows from the population, i.e., no births, deaths, or migration. This is often described as a _closed population_.
 - That is, the epidemic occurs much faster than the time scale of births, deaths, or migration.

- Mixing is homogeneous, i.e., individuals mix randomly and have an equal probability of coming into contact with any other individual in the population.

- Transition rates are constant and do not change over time.

- When this assumption is "relaxed"/included, we get more complex models.

---

## Transitions between compartments

- There are two processes that govern the transitions between compartments:
  - Transmission, governed by the transmission rate, $\beta$ (rate at which susceptible individuals become infected).
  - Recovery, governed by the recovery rate, $\gamma$ (rate at which infected individuals recover and become immune).
  
---

### Transmission

::: {.callout-caution collapse="true" icon=false}
# Question

- What factors drive transmission?
:::

---

- Transmission is driven by several factors:
  - The prevalence, [$I$]{style="color:orange;"}, i.e., number of infected individuals at the time.
  - The number of contacts, [$C$]{style="color:orange;"}, susceptible individuals have with infected individual.
  - The probability, [$p$]{style="color:orange;"}, a susceptible individual will become infected when they contact an infected individual.

---

- The transmission term is often defined through the force of infection (FOI), $\lambda$:
  - The force of infection is the [per capita rate]{style="color:orange;"} at which susceptible individuals become infected.

- The rate at which new infecteds are generated is given by [$\lambda S$]{style="color:orange;"}, where $S$ is the number of susceptible individuals.

- The force of infection is proportional to the number of infected individuals and the transmission rate, [$\beta$]{style="color:orange;"}.

- $\beta$ is the product of the contact rate and the probability of transmission per contact.

---

- The FOI can be formulated in two ways, depending on how the contact rate is expected to change with the population size:
  - [_Frequency-dependent/mass action transmission_]{style="color:orange;"}: The rate of contact between individuals is proportional to the population size. Here, [$\lambda = \beta \times \dfrac{I}{N}$]{style="color:orange;"}.
  - [_Density dependent transmission_]{style="color:orange;"}: The rate of contact between individuals is independent of the population size. Here, [$\lambda = \beta \times I$]{style="color:orange;"}.

---

- Frequency-dependent transmission assumes that that the number of contacts an individual has is independent of the population size:
  - Often used to model vector-borned diseases and diseases with heterogeneity in contact rates.

---

- Density-dependent transmission assumes that the number of contacts an individual has is proportional to the population size:
  - Often used to model diseases that allow the safe assumption of random/homogenous mixing.

::: {.callout-note}
The differences become important when dealing with population sizes that change significantly over time.
:::

---

- The recovery rate $\gamma$ is the reciprocal of the average duration of the infection. That is, infected individuals spend $1/\gamma$ days in the infected compartment before recovering.

- The average infectious period is often estimated from epidemiological data.

## Threshold phenomena

- Let's study the factors that will determine whether an epidemic will grow or not.

- Consider the case where $I(0)$ individuals are introduced into a population of size $N$ at time $t = 0$.

- That means in a completely susceptible population, we have $S(0) = N - I(0)$ susceptibles.

- Recall from the SIR model that $\dfrac{dI}{dt} = I (\beta S - \gamma)$

::: {.callout-caution collapse="true" icon=false}
# Question

- What will cause $\dfrac{dI}{dt} > 0$? and how do we interpret it?
:::

---

- $\dfrac{dI}{dt} > 0$ when $S > \dfrac{\gamma}{\beta}$

- Hence, at $t = 0$, $S(0)$ must be greater than $\dfrac{\gamma}{\beta}$ for the epidemic to grow.

- This can be interpreted to mean that we require the rate of recovery must be less than the rate of transmission for the epidemic to grow.

- The reverse of the removal rate is the reproduction number, $R_0 = \dfrac{\beta}{\gamma}$.

# The Basic Reproduction Number

- The basic reproduction number, [$R_0$]{style="color:tomato"}, is the rate at which secondary infections are generated from a [single primary infection]{style="color:tomato"} in a [completely susceptible]{style="color:tomato"} population.

- $R0$ is often used to express the threshold phenomena in infectious disease epidemiology:
  - If $R_0 > 1$, the epidemic will grow.
  - If $R_0 < 1$, the epidemic will decline.
  
- The value of $R0$ is determined by the disease and characteristics of the population.

- We will learn how to derive $R_0$ from various model structures in a dedicated section.

## The SEIR Model

- This extends the SIR model to include an exposed compartment, $E$. The exposed compartment represents individuals who have been infected but are not yet infectious.

- It is important to capture this compartment because some diseases have an incubation period during which individuals are infected but not yet infectious. Examples include COVID-19 and Ebola.

# Controlling Epidemics

## Modelling Vaccination

- Refer to the slides on vaccination.
- These work to reduce the number of susceptible individuals, $S$ and infecteds.

## Modelling NPIs

- Refer to the slides on NPIs.

- These work to reduce the transmission rate, $\beta$.

# Incorporating Host Heterogeneity

- The models we have discussed so far assume that all individuals in the population are identical.

- However, in reality, individuals differ in their susceptibility to infection and their ability to transmit the disease.

- It is essential to capture this heterogeneity in the models in order for the models to be more realistic and useful for decision-making ().

- This can be captured by incorporating heterogeneity into the models.


## Incorporating Age Structure

- The models we have discussed so far assume that the population is homogeneous.

- However, in reality, populations are structured by age.

- This can be captured by incorporating age structure into the models.

- Let's extend the SIR model to include age structure.

---

- We will divide the population into $n$ age groups.

- The model will have $3n$ compartments: $S_1, I_1, R_1, S_2, I_2, R_2, ..., S_n, I_n, R_n$.

- The model will have $n^2$ parameters: $\beta_{ij}$, the transmission rate from age group $i$ to age group $j$.

- The model equations will be:

\begin{aligned}
\dfrac{dS_i}{dt} &= -\sum_{j=1}^{n} \beta_{ji} S_i I_j \\
\dfrac{dI_i}{dt} &= \sum_{j=1}^{n} \beta_{ji} S_i I_j - \gamma I_i \\
\dfrac{dR_i}{dt} &= \gamma I_i
\end{aligned}

- The model can be used to study the impact of age structure on the dynamics of the epidemic.

---

- The model can be used to study the impact of age structure on the dynamics of the epidemic.

- For example, we can study the impact of vaccinating different age groups on the dynamics of the epidemic.

---

- Let's assume that the transmission rate from age group $i$ to age group $j$ is given by:

\[
\beta_{ij} = \beta_0 \left(1 + \alpha \left(\dfrac{a_i - a_j}{a_i + a_j}\right)\right)
\]

- where $\beta_0$ is the baseline transmission rate, $\alpha$ is the age-dependent transmission rate, and $a_i$ is the average age of individuals in age group $i$.

---

## Other Heterogeneities

- Other forms of heterogeneity that can be incorporated into the models include:

  - Spatial heterogeneity
  - Temporal heterogeneity
  - Contact heterogeneity

# Wrap-Up and Q&A

# List of Resources

## Textbooks

-   [Modeling Infectious Diseases in Humans and Animals by Matt Keeling and Pejman Rohani](https://www.amazon.co.uk/Modeling-Infectious-Diseases-Humans-Animals/dp/0691116172) -[Epidemics: Models and Data Using R by Ottar N. Bjornstad](https://link.springer.com/book/10.1007/978-3-031-12056-5)
-   [Infectious Disease Modelling by Emilia Vynnycky and Richard White](https://www.amazon.co.uk/Introduction-Infectious-Disease-Modelling/dp/0198565763)
-   [Infectious Diseases of Humans: Dynamics and Control by Roy M. Anderson and Robert M. May](https://www.amazon.co.uk/Infectious-Diseases-Humans-Dynamics-Control/dp/019854040X)

## Papers and Articles {.scrollable}

### Modelling infectious disease transmission

-   [Kirkeby, C., Brookes, V. J., Ward, M. P., Dürr, S., & Halasa, T. (2021). A practical introduction to mechanistic modeling of disease transmission in veterinary science. Frontiers in veterinary science, 7, 546651.](https://www.frontiersin.org/articles/10.3389/fvets.2020.546651/full)
-   [Blackwood, J. C., & Childs, L. M. (2018). An introduction to compartmental modeling for the budding infectious disease modeler.](https://vtechworks.lib.vt.edu/items/61e9ca00-ef21-4356-bcd7-a9294a1d2f17)
-   [Grassly, N. C., & Fraser, C. (2008). Mathematical models of infectious disease transmission. Nature Reviews Microbiology, 6(6), 477–487.](https://doi.org/10.1038/nrmicro1845)
-   [Cobey, S. (2020). Modeling infectious disease dynamics. Science, 368(6492), 713–714.](https://doi.org/10.1126/science.abb5659)
-   [Bjørnstad, O. N., Shea, K., Krzywinski, M., & Altman, N. (2020). Modeling infectious epidemics. Nature Methods, 17(5), 455–456.](https://doi.org/10.1038/s41592-020-0822-z)
-   [Bodner, K., Brimacombe, C., Chenery, E. S., Greiner, A., McLeod, A. M., Penk, S. R., & Soto, J. S. V. (2021). Ten simple rules for tackling your first mathematical models: A guide for graduate students by graduate students. PLOS Computational Biology, 17(1), e1008539.](https://doi.org/10.1371/journal.pcbi.1008539)
-   [Mishra, S., Fisman, D. N., & Boily, M.-C. (2011). The ABC of terms used in mathematical models of infectious diseases. Journal of Epidemiology & Community Health, 65(1), 87–94.](https://jech.bmj.com/content/65/1/87)
-   [James, L. P., Salomon, J. A., Buckee, C. O., & Menzies, N. A. (2021). The Use and Misuse of Mathematical Modeling for Infectious Disease Policymaking: Lessons for the COVID-19 Pandemic. 41(4), 379–385.](https://doi.org/10.1177/0272989X21990391)
-   [Holmdah, I., & Buckee, C. (2020). Wrong but useful—What COVID-19 epidemiologic models can and cannot tell us. New England Journal of Medicine.](https://doi.org/10.1056/nejmp2009027)
-   [Metcalf, C. J. E. E., Edmunds, W. J., & Lessler, J. (2015). Six challenges in modelling for public health policy. Epidemics, 10(2015), 93–96.](https://doi.org/10.1016/j.epidem.2014.08.008)
-   [Roberts, M., Andreasen, V., Lloyd, A., & Pellis, L. (2015). Nine challenges for deterministic epidemic models. Epidemics, 10(2015), 49–53.](https://doi.org/10.1016/j.epidem.2014.09.006)

### Deriving and Interpreting R0

-   [Jones, J. H. (2011). Notes On R0. Building, 1–19.](https://web.stanford.edu/~jhj1/teachingdocs/Jones-on-R0.pdf)
-   [Diekmann, O., Heesterbeek, J. A. P., & Metz, J. A. J. (1990). On the definition and the computation of the basic reproduction ratio R0 in models for infectious diseases in heterogeneous populations. Journal of Mathematical Biology, 28(4), 365–382.](https://doi.org/10.1007/BF00178324)
-   [Diekmann, O., Heesterbeek, J. A. P., & Roberts, M. G. (2010). The construction of next-generation matrices for compartmental epidemic models. Journal of the Royal Society Interface, 7(47), 873–885.](https://doi.org/10.1098/rsif.2009.0386)

### References

::: {#refs}
:::
